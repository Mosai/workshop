#/usr/bin/env sh

# Gets the lib folder relative to this script location
# If this script is in /foo/bin, points to /foo/lib
lib_path="$(cd "$(dirname "$0")/../lib";pwd)"

. "$lib_path/common.sh"   || exit 1
. "$lib_path/dispatch.sh" || exit 1
. "$lib_path/trix.sh"     || exit 1

# Dispatches commands to other trix_ functions
trix () ( dispatch trix "${@:-}" )

# Provides help
trix_command_help ()
{
	cat <<-HELP
	   Usage: trix [option_list...] [command]
	          trix help, -h, --help [command]  Displays help for command.

	Commands: run    [file]  Runs the target matrix file
	          list   [file]  Lists all tested environments

	 Options: --env    [name]  Runs only the selected environment
	          --matrix [name]  Runs only the selected matrix

	HELP
}

trix_option_help   () ( trix_command_help )
trix_option_h      () ( trix_command_help )
trix_option_env    () ( trix_env_filter="$1"; shift; dispatch trix "${@:-}" )
trix_option_matrix ()
{
	trix_matrix_filter="$1"
	shift
	dispatch trix "${@:-}"
}

trix_      () ( echo "No command provided. Try 'trix --help'"; return 1 )
trix_call_ () ( echo "Call '$*' invalid. Try 'trix --help'";   return 1 )



trix "${@:-}"
